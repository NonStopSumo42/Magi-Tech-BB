<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LOG ARCHIVE</title>

<style>
body {
  background:#020a07;
  color:#3aff7a;
  font-family:monospace;
  text-shadow:0 0 5px rgba(58,255,122,.7);
}
.frame {
  border:2px solid #3aff7a;
  margin:12px;
  padding:12px;
}
.log {
  border-bottom:1px dashed #1f5;
  margin-bottom:10px;
}
input, textarea, button {
  width:100%;
  background:black;
  color:#3aff7a;
  border:2px solid #3aff7a;
  margin-top:6px;
}
</style>
</head>

<body>

<div class="frame">
  <h2>SYSTEM LOGS</h2>
  <div id="out"></div>
</div>

<div class="frame">
  <h3>NEW LOG ENTRY</h3>
  <input id="title" placeholder="TITLE">
  <input id="author" placeholder="AUTHOR">
  <textarea id="text" placeholder="BLANK LINE = NEW PARAGRAPH"></textarea>
  <button onclick="add()">WRITE</button>
</div>

<script>
const session = JSON.parse(localStorage.getItem("session"));
if (!session) location = "/";

function load() {
  fetch("/logs")
    .then(r=>r.json())
    .then(data=>{
      out.innerHTML="";
      data.forEach(l=>{
        out.innerHTML += `
          <div class="log">
            <h3>${l.title}</h3>
            <b>${l.author}</b>
            ${l.paragraphs.map(p=>`<p>${p}</p>`).join("")}
          </div>`;
      });
    });
}

function add() {
  fetch("/logs",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      title: title.value,
      author: author.value,
      paragraphs: text.value.split("\n\n")
    })
  }).then(()=>{ text.value=""; load(); });
}

load();
</script>

</body>
</html>
