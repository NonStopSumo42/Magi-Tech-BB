<!DOCTYPE html>
<html>
<body style="background:black;color:#3aff7a;font-family:monospace">

<h2>INBOX</h2>
<div id="msgs"></div>

<input id="to" placeholder="to">
<input id="sub" placeholder="subject">
<textarea id="body"></textarea>
<button onclick="send()">Send</button>

<script>
const s=JSON.parse(localStorage.getItem("session"));

function load(){
 fetch("/inbox").then(r=>r.json()).then(d=>{
  msgs.innerHTML="";
  d.forEach(m=>{
   msgs.innerHTML+=`<div class="${m.color}">${m.from}: ${m.body}</div>`;
  });
 });
}

function send(){
 fetch("/inbox/send",{method:"POST",headers:{'Content-Type':'application/json'},
 body:JSON.stringify({from:s.publicName||s.username,to:to.value,subject:sub.value,body:body.value,color:s.color})})
 .then(load);
}

load();
</script>
</body>
</html>
