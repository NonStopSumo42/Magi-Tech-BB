<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MAIL TERMINAL</title>

<style>
body {
  background:#020a07;
  color:#3aff7a;
  font-family:monospace;
  text-shadow:0 0 5px rgba(58,255,122,.7);
}
.frame {
  border:2px solid #3aff7a;
  padding:12px;
  margin:12px;
}
.msg {
  border-bottom:1px dashed #1f5;
  padding:6px 0;
}
input, textarea, button {
  width:100%;
  background:black;
  color:#3aff7a;
  border:2px solid #3aff7a;
  margin-top:6px;
}
</style>
</head>

<body>

<div class="frame">
  <h2>PRIVATE MAIL</h2>
  <div id="msgs"></div>
</div>

<div class="frame">
  <h3>SEND MESSAGE</h3>
  <input id="to" placeholder="RECIPIENT">
  <input id="subject" placeholder="SUBJECT">
  <textarea id="body"></textarea>
  <button onclick="send()">SEND</button>
</div>

<script>
const session = JSON.parse(localStorage.getItem("session"));
if (!session) {
  location = "/";
}

function load() {
  fetch("/inbox")
    .then(r=>r.json())
    .then(data=>{
      msgs.innerHTML="";
      data.forEach(m=>{
        msgs.innerHTML += `
          <div class="msg">
            FROM: ${m.from}<br>
            TO: ${m.to}<br>
            SUBJECT: ${m.subject}<br>
            ${m.body}
          </div>`;
      });
    });
}

function send() {
  fetch("/inbox/send",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      from: session.publicName || session.username,
      to: to.value,
      subject: subject.value,
      body: body.value
    })
  }).then(()=>{ body.value=""; load(); });
}

load();
</script>

</body>
</html>
