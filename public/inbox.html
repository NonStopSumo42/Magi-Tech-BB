<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MAGITECH BB – INBOX</title>
<style>
body { background:black; color:#3aff7a; font-family:monospace; }
.msg { border-bottom:1px solid #144; padding:6px; }
.blue{color:#2fd0ff;} .orange{color:#ff9a2f;}
</style>
</head>
<body>

<h2>PRIVATE INBOX</h2>
<div id="messages"></div>

<h3>Send Message</h3>
<input id="to" placeholder="To"><br>
<input id="subject" placeholder="Subject"><br>
<textarea id="body"></textarea><br>
<button onclick="send()">Send</button>

<script>
const session = JSON.parse(localStorage.getItem("session"));

function load(){
  fetch("/inbox").then(r=>r.json()).then(data=>{
    messages.innerHTML="";
    data.forEach(m=>{
      const d=document.createElement("div");
      d.className="msg "+m.color;
      d.innerHTML=`<b>${m.from}</b> → ${m.to}<br>${m.subject}<br>${m.body}`;
      messages.appendChild(d);
    });
  });
}

function send(){
  fetch("/inbox/send",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      from: session.username,
      to: to.value,
      subject: subject.value,
      body: body.value,
      color: session.color
    })
  }).then(()=>{ body.value=""; load(); });
}

load();
</script>
</body>
</html>
